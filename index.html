<!--
  SDA uStream Listing
  Author: Ian "bmn" Bennett
  
  Version History:
  0.1 <2010/04/17> Initial version.
  0.2 <2010/04/18> Streamlined JSON format; embeds for online streams only.
-->
<html>
  <head>
    <title>Speed Demos Archive uStreamers</title>
    <style type="text/css">
      body {
        font-family: Arial, sans-serif;
        font-size: 14px;
        background-color: #222;
        color: #eee;
        text-align: center;
      }
      div.wrapper {
        margin: 0 auto;
      }
      div.entry {
        float: left;
        margin: 10px 5px;
        width: 340px;
      }
      div.synopsis {
        margin-top: 3px;
        height: 30px;
      }
      #offline {
        width: 900px;
        margin: 0 auto;
      }
      h1 {
        margin-bottom: 0;
      }
      h2 {
        padding-top: 25px;
        margin-bottom: 5px;
        clear: both;
      }
      h3 {
        margin: 2px;
        font-size: 18px;
      }
      a {
        text-decoration: none;
        color: inherit;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1>Speed Demos Archive uStreamers</h1>
    <div id="wrapper">
      <div id="online">
      </div>
    </div>
    <div id="offline">
    </div>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script type="text/javascript" src="config.js"></script>
    <script type="text/javascript">    
      // Summek kool
      Object.size = function(obj) {
        var size = 0, key;
        for (key in obj) {
            if (obj.hasOwnProperty(key)) size++;
        }
        return size;
      };

      // Nice centered goodness
      entry_width = 350;
      window_width = (self.innerHeight) ? self.innerWidth : (document.documentElement && document.documentElement.clientHeight) ? document.documentElement.clientWidth : (document.body) ? document.body.clientWidth : false;
      max_entries = Math.floor(window_width / entry_width);
      
      // Get the API data and make the content
      req = '';
      online = offline = {};
      c_on = c_off = '';
      ct_on = c = 0;
      for (var i in channels) {
        c++;
        req = req+i+';';
        if (((c % 10) == 0) || (c == (Object.size(channels)))) {
          req = 'http://api.ustream.tv/json/channel/'+req.slice(0, -1)+'/getInfo?key='+key+'&callback=?';
          $.getJSON(req, function(j) {
            if (j) {
              for (var k in j) {
                var u = j[k]['result'];
                u['synopsis'] = channels[u['urlTitleName']];
                if (u['status'] == 'offline') {
                  c_off = c_off+'<a href="'+u['url']+'" title="'+u['synopsis']+'">'+u['user']['userName']+'</a> : ';
                }
                else {
                  ct_on++;
                  c_on = c_on+' \
<div class="entry"> \
  <h3> \
    <a href="http://www.ustream.tv/channel/'+u['urlTitleName']+'">'+u['user']['userName']+'</a> \
  </h3> \
  '+u['embedTag']+' \
  <div class="synopsis">'+u['synopsis']+'</div> \
</div> \
                  ';
                }
              }
              $("#wrapper").width( ((max_entries < ct_on) ? max_entries : ct_on) * entry_width);
              $("#wrapper").css('margin', '0 auto');
              if (c_on) $("#online").html('<h2>Running Now...</h2>'+c_on);
              if (c_off) $("#offline").html('<h2>Lazy Bums...</h2>'+c_off.slice(0, -3));
            }
          });
          req = '';
        }
      }
    </script>
  </body>
</html>